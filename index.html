
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åœ“æ»¿å®®è–äº‹å ±å</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; background: linear-gradient(to right, #f3f4f6, #e5e7eb); padding: 2em; max-width: 800px; margin: auto; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    h1, h2 { text-align: center; color: #1f2937; }
    label { font-weight: bold; margin-top: 1.5em; }
    input, select { padding: 0.75em; border: 1px solid #d1d5db; border-radius: 8px; margin-top: 0.5em; width: 100%; box-sizing: border-box; background-color: #fff; }
    button { background-color: #3b82f6; color: white; font-weight: bold; border: none; border-radius: 8px; padding: 0.75em; margin-top: 2em; width: 100%; cursor: pointer; transition: background-color 0.3s ease; }
    button:hover { background-color: #2563eb; }
    .success, .error { margin-top: 1em; font-weight: bold; text-align: center; padding: 1em; border-radius: 8px; }
    .success { background-color: #d1fae5; color: #065f46; }
    .error { background-color: #fee2e2; color: #b91c1c; }
    table { width: 100%; border-collapse: collapse; margin-top: 2em; background-color: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    th { background-color: #f9fafb; color: #111827; }
    th, td { border: 1px solid #e5e7eb; padding: 0.75em; text-align: center; }
  </style>
</head>
<body>
  <div style="text-align: center; margin-bottom: 1.5em;">
    <img src="./logo.jpg" alt="åœ“æ»¿å®® logo" style="max-width: 150px; height: auto; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
  </div>
  <h1>åœ“æ»¿å®®å•äº‹å ±åç³»çµ±</h1>
  <p style="text-align:center; font-weight:bold; color:#b45309;">âš ï¸ ä¸€äººæœ€å¤šå ±åä¸‰å€‹åé¡ï¼Œè«‹å‹¿é‡è¤‡å¡«å¯«ã€‚</p>

  <form id="signup-form">
    <label for="nickname">æš±ç¨±ï¼ä»£è™Ÿï¼š</label>
    <input type="text" id="nickname" required />

    <label for="reason">äº‹ç”±ï¼š</label>
    <select id="reason" required>
      <option value="ç¬¬ä¸€æ¬¡å•äº‹">ç¬¬ä¸€æ¬¡å•äº‹</option>
      <option value="å•äº‹">å•äº‹</option>
      <option value="é–‹å–®">é–‹å–®</option>
    </select>

    <label for="date">é¸æ“‡æ—¥æœŸï¼š</label>
    <select id="date" required></select>

    <label for="timeslot">é¸æ“‡æ™‚æ®µï¼š</label>
    <select id="timeslot" required></select>

    <button type="submit">æäº¤å ±å</button>
  </form>

  <div class="success" id="success-msg" style="display:none;">å ±åæˆåŠŸï¼Œç¥é—”å®¶å¹³å®‰ï¼</div>
  <div class="error" id="error-msg" style="display:none;"></div>

  <hr />
  <h2>å ±åè³‡æ–™ç¸½è¦½ï¼ˆåƒ…ä¾›ä¸»è¾¦äººä½¿ç”¨ï¼‰</h2>
  <button onclick="verifyAndExport()">åŒ¯å‡º Excel æª”</button>
  <table id="signup-table">
    <thead>
      <tr><th>æš±ç¨±ï¼ä»£è™Ÿ</th><th>äº‹ç”±</th><th>æ—¥æœŸ</th><th>æ™‚æ®µ</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  // ğŸ”§ æ¯æœˆåº•åªè¦æ”¹é€™è£¡å…©è¡Œ â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“â†“
  const dateOptions = [
    { value: "2025-08-03", label: "8æœˆ03æ—¥" },
    { value: "2025-08-17", label: "8æœˆ17æ—¥" }
  ];
  // â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘ğŸ”§ å°±é€™è£¡

  const dateSelect = document.getElementById("date");
  dateOptions.forEach(opt => {
    const el = document.createElement("option");
    el.value = opt.value;
    el.textContent = opt.label;
    dateSelect.appendChild(el);
  });

  const timeSlots = [];
  for (let h = 9; h < 17; h++) {
    if (h === 12) continue;
    timeSlots.push(`${h}:00`, `${h}:30`);
  }
  const timeSelect = document.getElementById("timeslot");
  timeSlots.forEach(t => {
    const el = document.createElement("option");
    el.value = t;
    el.textContent = t;
    timeSelect.appendChild(el);
  });

  const form = document.getElementById("signup-form");
  const successMsg = document.getElementById("success-msg");
  const errorMsg = document.getElementById("error-msg");

  const maxPerSlot = 1;
  const maxPerDay = 15;
  const maxPerPerson = 3;
  const storageKey = "anonymousSignups";

  function loadData() {
    return JSON.parse(localStorage.getItem(storageKey) || "[]");
  }

  function saveData(data) {
    localStorage.setItem(storageKey, JSON.stringify(data));
  }

  function renderTable() {
    const data = loadData();
    const tbody = document.querySelector("#signup-table tbody");
    tbody.innerHTML = "";
    data.forEach(d => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${d.nickname}</td><td>${d.reason}</td><td>${d.date}</td><td>${d.timeslot}</td>`;
      tbody.appendChild(row);
    });
  }

  function verifyAndExport() {
    const input = prompt("è«‹è¼¸å…¥ä¸»äº‹äººå¯†ç¢¼æ‰èƒ½åŒ¯å‡ºå ±åè³‡æ–™ï¼š");
    if (input === "yuanman666") exportCSV();
    else alert("å¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•åŒ¯å‡ºè³‡æ–™ã€‚");
  }

  function exportCSV() {
    const data = loadData();
    let csv = "æš±ç¨±ï¼ä»£è™Ÿ,äº‹ç”±,æ—¥æœŸ,æ™‚æ®µ\n";
    data.forEach(d => {
      csv += `${d.nickname},${d.reason},${d.date},${d.timeslot}\n`;
    });
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "å ±åè³‡æ–™.csv";
    a.click();
    URL.revokeObjectURL(url);
  }

  form.addEventListener("submit", function (e) {
    e.preventDefault();
    const nickname = document.getElementById("nickname").value.trim();
    const reason = document.getElementById("reason").value;
    const date = document.getElementById("date").value;
    const timeslot = document.getElementById("timeslot").value;

    const data = loadData();

    if (data.filter(d => d.nickname === nickname).length >= maxPerPerson) {
      errorMsg.textContent = "æ¯äººæœ€å¤šå¯å ±åä¸‰å€‹åé¡ã€‚";
      successMsg.style.display = "none";
      errorMsg.style.display = "block";
      return;
    }

    const sameDate = data.filter(d => d.date === date);
    if (sameDate.length >= maxPerDay) {
      errorMsg.textContent = "æœ¬æ—¥åé¡å·²æ»¿ï¼Œè«‹é¸æ“‡å…¶ä»–æ—¥æœŸã€‚";
      successMsg.style.display = "none";
      errorMsg.style.display = "block";
      return;
    }

    if (sameDate.filter(d => d.timeslot === timeslot).length >= maxPerSlot) {
      errorMsg.textContent = "æ­¤æ™‚æ®µå·²é¡æ»¿ï¼Œè«‹é¸æ“‡å…¶ä»–æ™‚æ®µã€‚";
      successMsg.style.display = "none";
      errorMsg.style.display = "block";
      return;
    }

    data.push({ nickname, reason, date, timeslot });
    saveData(data);
    renderTable();
    form.reset();
    errorMsg.style.display = "none";
    successMsg.style.display = "block";
  });

  renderTable();
</script>
</body>
</html>
